"use strict";(self.webpackChunkgreenfield_docs=self.webpackChunkgreenfield_docs||[]).push([[7715],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>k});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),l=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,c=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=l(a),h=r,k=d["".concat(c,".").concat(h)]||d[h]||u[h]||s;return a?n.createElement(k,i(i({ref:t},p),{},{components:a})):n.createElement(k,i({ref:t},p))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,i=new Array(s);i[0]=h;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o[d]="string"==typeof e?e:r,i[1]=o;for(var l=2;l<s;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},88483:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var n=a(87462),r=(a(67294),a(3905));const s={},i="Task",o={unversionedId:"guide/storage-provider/modules/common/task",id:"guide/storage-provider/modules/common/task",title:"Task",description:"Task is an abstract interface to describe the smallest unit of SP background service how to interact.",source:"@site/docs/guide/storage-provider/modules/common/task.md",sourceDirName:"guide/storage-provider/modules/common",slug:"/guide/storage-provider/modules/common/task",permalink:"/greenfield-docs/docs/guide/storage-provider/modules/common/task",draft:!1,editUrl:"https://github.com/bnb-chain/greenfield-docs/blob/main/docs/guide/storage-provider/modules/common/task.md",tags:[],version:"current",frontMatter:{}},c={},l=[{value:"Task Type",id:"task-type",level:2},{value:"ApprovalTask",id:"approvaltask",level:3},{value:"ApprovalCreateBucketTask",id:"approvalcreatebuckettask",level:4},{value:"ApprovalMigrateBucketTask",id:"approvalmigratebuckettask",level:3},{value:"ApprovalCreateObjectTask",id:"approvalcreateobjecttask",level:4},{value:"ApprovalReplicatePieceTask",id:"approvalreplicatepiecetask",level:4},{value:"ObjectTask",id:"objecttask",level:3},{value:"UploadObjectTask",id:"uploadobjecttask",level:4},{value:"ResumableUploadObjectTask",id:"resumableuploadobjecttask",level:3},{value:"ReplicatePieceTask",id:"replicatepiecetask",level:4},{value:"ReceivePieceTask",id:"receivepiecetask",level:4},{value:"SealObjectTask",id:"sealobjecttask",level:4},{value:"DownloadObjectTask",id:"downloadobjecttask",level:4},{value:"DownloadPieceTask",id:"downloadpiecetask",level:4},{value:"ChallengePieceTask",id:"challengepiecetask",level:4},{value:"GC Task",id:"gc-task",level:3},{value:"GCObjectTask",id:"gcobjecttask",level:4},{value:"GCZombiePieceTask",id:"gczombiepiecetask",level:4},{value:"GCMetaTask",id:"gcmetatask",level:4},{value:"RecoveryPieceTask",id:"recoverypiecetask",level:3},{value:"MigrateGVGTask",id:"migrategvgtask",level:3},{value:"Task Type Definition",id:"task-type-definition",level:2},{value:"Task Priority",id:"task-priority",level:2},{value:"Task Priority Level",id:"task-priority-level",level:2},{value:"Task Init",id:"task-init",level:2}],p={toc:l},d="wrapper";function u(e){let{components:t,...a}=e;return(0,r.kt)(d,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"task"},"Task"),(0,r.kt)("p",null,"Task is an abstract interface to describe the smallest unit of SP background service how to interact."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type Task interface {\n    // Key returns the uniquely identify of the task. It is recommended that each task\n    // has its own prefix. In addition, it should also include the information of the\n    // task's own identity.\n    // For example:\n    // 1. ApprovalTask maybe includes the bucket name and object name,\n    // 2. ObjectTask maybe includes the object ID,\n    // 3. GCTask maybe includes the timestamp.\n    Key() TKey\n    // Type returns the type of the task. A task has a unique type, such as\n    // TypeTaskCreateBucketApproval, TypeTaskUpload etc. has the only one TType\n    // definition.\n    Type() TType\n    // GetAddress returns the task runner address. there is only one runner at the\n    // same time, which will assist in quickly locating the running node of the task.\n    GetAddress() string\n    // SetAddress sets the runner address to the task.\n    SetAddress(string)\n    // GetCreateTime returns the creation time of the task. The creation time used to\n    // judge task execution time.\n    GetCreateTime() int64\n    // SetCreateTime sets the creation time of the task.\n    SetCreateTime(int64)\n    // GetUpdateTime returns the last updated time of the task. The updated time used\n    // to determine whether the task is expired with the timeout.\n    GetUpdateTime() int64\n    // SetUpdateTime sets last updated time of the task. Any changes in task information\n    // requires to set the update time.\n    SetUpdateTime(int64)\n    // GetTimeout returns the timeout of the task, the timeout is a duration, if update\n    // time adds timeout lesser now stands the task is expired.\n    GetTimeout() int64\n    // SetTimeout sets timeout duration of the task.\n    SetTimeout(int64)\n    // ExceedTimeout returns an indicator whether timeout, if update time adds timeout\n    // lesser now returns true, otherwise returns false.\n    ExceedTimeout() bool\n    // GetMaxRetry returns the max retry times of the task. Each type of task has a\n    // fixed max retry times.\n    GetMaxRetry() int64\n    // SetMaxRetry sets the max retry times of the task.\n    SetMaxRetry(int64)\n    // GetRetry returns the retry counter of the task.\n    GetRetry() int64\n    // SetRetry sets the retry counter of the task.\n    SetRetry(int)\n    // IncRetry increases the retry counter of the task. Each task has the max retry\n    // times, if retry counter exceed the max retry, the task should be canceled.\n    IncRetry()\n    // ExceedRetry returns an indicator whether retry counter greater that max retry.\n    ExceedRetry() bool\n    // Expired returns an indicator whether ExceedTimeout and ExceedRetry.\n    Expired() bool\n    // GetPriority returns the priority of the task. Each type of task has a fixed\n    // priority. The higher the priority, the higher the urgency of the task, and\n    // it will be executed first.\n    GetPriority() TPriority\n    // SetPriority sets the priority of the task. In most cases, the priority of the\n    // task does not need to be set, because the priority of the task corresponds to\n    // the task type one by one. Once the task type is determined, the priority is\n    // determined. But some scenarios need to dynamically adjust the priority of the\n    // task type, then this interface is needed.\n    SetPriority(TPriority)\n    // EstimateLimit returns estimated resource will be consumed. It is used for\n    // application resources to the rcmgr and decide whether it can be executed\n    // immediately.\n    EstimateLimit() rcmgr.Limit\n    // SetLogs sets the event logs to task\n    SetLogs(logs string)\n    // GetLogs returns the logs of task\n    GetLogs() string\n    // GetUserAddress returns the user account of downloading object.\n    // It is used to record the read bucket information.\n    GetUserAddress() string\n    // SetUserAddress sets the user account of downloading object.\n    SetUserAddress(string)\n    // AppendLog appends the event log to task\n    AppendLog(log string)\n    // Info returns the task detail info for log and debug.\n    Info() string\n    // Error returns the task error. if the task is normal, returns nil.\n    Error() error\n    // SetError sets the error to task. Any errors that occur during task execution\n    // will be logged through the SetError method.\n    SetError(error)\n}\n")),(0,r.kt)("h2",{id:"task-type"},"Task Type"),(0,r.kt)("p",null,"There are three main types of task: ",(0,r.kt)("inlineCode",{parentName:"p"},"ApprovalTask"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"ObjectTask")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"GCTask"),"."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ApprovalTask")," is used to record approval information for users creating buckets and objects. Primary SP approval is required\nbefore serving the bucket and object. If SP approves the message, it will sign the approval message. The greenfield will\nverify the signature of the approval message to determine whether the SP accepts the bucket and object. When primary replicating\npieces to secondary SPs, the approval message is broadcast to other SPs. If they approve the message, the primary SP will\nselect some of them to replicate the pieces to. Before receiving the pieces, the selected SPs will verify the signature\nof the approval message. ",(0,r.kt)("inlineCode",{parentName:"p"},"ApprovalTask")," includes ",(0,r.kt)("inlineCode",{parentName:"p"},"ApprovalCreateBucketTask"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"ApprovalCreateBucketTask")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"ApprovalReplicatePieceTask"),"."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ObjectTask")," is associated with an object and records information about its different stages. This includes ",(0,r.kt)("inlineCode",{parentName:"p"},"UploadObjectTask"),"\nwhich uploads the object payload data to the primary SP, ",(0,r.kt)("inlineCode",{parentName:"p"},"ReplicatePieceTask"),", which replicates the object pieces to the\nsecondary SPs, and ",(0,r.kt)("inlineCode",{parentName:"p"},"ReceivePieceTask"),", which is exclusive to the secondary SP and records information about receiving\nthe piece. The secondary SP uses this information to confirm whether the object was successfully sealed on greenfield,\nensuring a return of the secondary SP. SealObjectTask seals the object on Greenfield, while the DownloadObjectTask allows\nthe user to download part or all of the object payload data. ChallengePieceTask provides the validator with challenge piece\ninformation, which they can use to challenge the SP if they suspect that the user's payload data was not stored correctly."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"GCTask")," is an abstract interface that records information about garbage collection. This includes ",(0,r.kt)("inlineCode",{parentName:"p"},"GCObjectTask")," which collects\npiece store space by deleting payload data that has been deleted on the greenfield, ",(0,r.kt)("inlineCode",{parentName:"p"},"GCZombiePieceTask")," which collects piece\nstore space by deleting zombie piece data that resulted from any exception where the piece data meta is not on Greenfield\nchain, and ",(0,r.kt)("inlineCode",{parentName:"p"},"GCMetaTask")," which collects the SP meta store space by deleting expired data."),(0,r.kt)("h3",{id:"approvaltask"},"ApprovalTask"),(0,r.kt)("p",null,"ApprovalTask is an abstract interface to record the ask approval information, the approval task timeliness uses the block height,\nif reached expired height, the approval is invalid."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type ApprovalTask interface {\n    Task\n    // GetExpiredHeight returns the expired height of the approval.\n    GetExpiredHeight() uint64\n    // SetExpiredHeight sets the expired height of the approval, when SP\n    // approved the approval, it should set the expired height to stands\n    // the approval timeliness. This is one of the ways SP prevents being\n    // attacked.\n    SetExpiredHeight(uint64)\n}\n")),(0,r.kt)("h4",{id:"approvalcreatebuckettask"},"ApprovalCreateBucketTask"),(0,r.kt)("p",null,"ApprovalCreateBucketTask is an abstract interface to record the ask create bucket approval information. The user account will\ncreate MsgCreateBucket, the SP should decide whether approved the request based on the MsgCreateBucket. If so, the sp will\nSetExpiredHeight and signs MsgCreateBucket."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type ApprovalCreateBucketTask interface {\n    ApprovalTask\n    // InitApprovalCreateBucketTask inits the ApprovalCreateBucketTask by\n    // MsgCreateBucket and task priority. SP only fill the MsgCreateBucket's\n    // PrimarySpApproval field, can not change other fields.\n    InitApprovalCreateBucketTask(string, *storagetypes.MsgCreateBucket, TPriority)\n    // GetCreateBucketInfo returns the user's MsgCreateBucket.\n    GetCreateBucketInfo() *storagetypes.MsgCreateBucket\n    // SetCreateBucketInfo sets the MsgCreateBucket. Should try to avoid calling\n    // this method, it will change the approval information.\n    SetCreateBucketInfo(*storagetypes.MsgCreateBucket)\n}\n")),(0,r.kt)("h3",{id:"approvalmigratebuckettask"},"ApprovalMigrateBucketTask"),(0,r.kt)("p",null,"ApprovalMigrateBucketTask is an abstract interface to record the ask migrate bucket approval information. The user account will\ncreate MsgMigrateBucket, the SP should decide whether approved the request based on the MsgMigrateBucket. If so, the sp will\nSetExpiredHeight and signs MsgCreateBucket."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type ApprovalMigrateBucketTask interface {\n    ApprovalTask\n    // InitApprovalMigrateBucketTask inits the ApprovalMigrateBucketTask by\n    // MsgCreateBucket and task priority. SP only fill the MsgCreateBucket's\n    // PrimarySpApproval field, can not change other fields.\n    InitApprovalMigrateBucketTask(*storagetypes.MsgMigrateBucket, TPriority)\n    // GetMigrateBucketInfo returns the user's MsgCreateBucket.\n    GetMigrateBucketInfo() *storagetypes.MsgMigrateBucket\n    // SetMigrateBucketInfo sets the MsgCreateBucket. Should try to avoid calling\n    // this method, it will change the approval information.\n    SetMigrateBucketInfo(*storagetypes.MsgMigrateBucket)\n}\n")),(0,r.kt)("h4",{id:"approvalcreateobjecttask"},"ApprovalCreateObjectTask"),(0,r.kt)("p",null,"ApprovalCreateObjectTask is an abstract interface to record the ask create object approval information. The user account will\ncreate MsgCreateObject, the SP should decide whether approved the request based on the MsgCreateObject. If so, the sp will\nSetExpiredHeight and signs MsgCreateObject."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type ApprovalCreateObjectTask interface {\n    ApprovalTask\n    // InitApprovalCreateObjectTask inits the ApprovalCreateObjectTask by\n    // MsgCreateObject and task priority. SP only fill the MsgCreateObject's\n    // PrimarySpApproval field, can not change other fields.\n    InitApprovalCreateObjectTask(*storagetypes.MsgCreateObject, TPriority)\n    // GetCreateObjectInfo returns the user's MsgCreateObject.\n    GetCreateObjectInfo() *storagetypes.MsgCreateObject\n    // SetCreateObjectInfo sets the MsgCreateObject. Should try to avoid calling\n    // this method, it will change the approval information.\n    SetCreateObjectInfo(*storagetypes.MsgCreateObject)\n}\n")),(0,r.kt)("h4",{id:"approvalreplicatepiecetask"},"ApprovalReplicatePieceTask"),(0,r.kt)("p",null,"ApprovalReplicatePieceTask is an abstract interface to record the ask replicate pieces to other SPs(as secondary SP for the object).\nIt is initiated by the primary SP in the replicate pieces phase.  Before the primary SP sends it to other SPs, the primary\nSP will sign the task, other SPs will verify it is sent by a legitimate SP. If other SPs approved the approval, they will\nSetExpiredHeight and signs ApprovalReplicatePieceTask."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type ApprovalReplicatePieceTask interface {\n    ObjectTask\n    ApprovalTask\n    // InitApprovalReplicatePieceTask inits the ApprovalReplicatePieceTask by ObjectInfo,\n    // storage params, task priority and primary operator address. the storage params\n    // can affect the size of the data accepted by secondary SP, so this is a necessary\n    // and cannot be changed parameter.\n    InitApprovalReplicatePieceTask(object *storagetypes.ObjectInfo, params *storagetypes.Params, priority TPriority, askOpAddress string)\n    // GetAskSpOperatorAddress returns the operator address of SP that initiated the ask\n    // replicate piece approval request.\n    GetAskSpOperatorAddress() string\n    // SetAskSpOperatorAddress sets the operator address of SP that initiated the ask\n    // replicate piece approval request. Should try to avoid calling this method,\n    // it will change the approval information.\n    SetAskSpOperatorAddress(string)\n    // GetAskSignature returns the initiated signature of SP signature by its operator private key.\n    GetAskSignature() []byte\n    // SetAskSignature sets the initiated signature of SP by its operator private key.\n    SetAskSignature([]byte)\n    // GetApprovedSpOperatorAddress returns the approved operator address of SP.\n    GetApprovedSpOperatorAddress() string\n    // SetApprovedSpOperatorAddress sets the approved operator address of SP.\n    SetApprovedSpOperatorAddress(string)\n    // GetApprovedSignature returns the approved signature of SP.\n    GetApprovedSignature() []byte\n    // SetApprovedSignature sets the approved signature of SP.\n    SetApprovedSignature([]byte)\n    // GetApprovedSpEndpoint returns the approved endpoint of SP. It is used to replicate\n    // pieces to secondary SP.\n    GetApprovedSpEndpoint() string\n    // SetApprovedSpEndpoint sets the approved endpoint of SP.\n    SetApprovedSpEndpoint(string)\n    // GetApprovedSpApprovalAddress returns the approved approval address of SP. It is\n    // used to seal object on greenfield.\n    GetApprovedSpApprovalAddress() string\n    // SetApprovedSpApprovalAddress sets the approved approval address of SP.\n    SetApprovedSpApprovalAddress(string)\n    // GetSignBytes returns the bytes from the task for initiated and approved SPs\n    // to sign.\n    GetSignBytes() []byte\n}\n")),(0,r.kt)("h3",{id:"objecttask"},"ObjectTask"),(0,r.kt)("p",null,"The ObjectTask associated with an object and storage params, and records the information of different stages of the object.\nConsidering the change of storage params on the greenfield, the storage params of each object should be determined when\nit is created, and it should not be queried during the task flow, which is inefficient and error-prone."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type ObjectTask interface {\n    Task\n    // GetObjectInfo returns the associated object.\n    GetObjectInfo() *storagetypes.ObjectInfo\n    // SetObjectInfo set the  associated object.\n    SetObjectInfo(*storagetypes.ObjectInfo)\n    // GetStorageParams returns the storage params.\n    GetStorageParams() *storagetypes.Params\n    // SetStorageParams sets the storage params.Should try to avoid calling this\n    // method, it will change the task base information.\n    // For example: it will change resource estimate for UploadObjectTask and so on.\n    SetStorageParams(*storagetypes.Params)\n}\n")),(0,r.kt)("h4",{id:"uploadobjecttask"},"UploadObjectTask"),(0,r.kt)("p",null,"The UploadObjectTask is an abstract interface to record the information for uploading object payload data to the primary SP."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type UploadObjectTask interface {\n    ObjectTask\n    // InitUploadObjectTask inits the UploadObjectTask by ObjectInfo and Params.\n    InitUploadObjectTask(vgfID uint32, object *storagetypes.ObjectInfo, params *storagetypes.Params, timeout int64)\n    // GetVirtualGroupFamilyId returns the object's virtual group family which is bind in bucket.\n    GetVirtualGroupFamilyId() uint32\n}\n")),(0,r.kt)("h3",{id:"resumableuploadobjecttask"},"ResumableUploadObjectTask"),(0,r.kt)("p",null,"The ResumableUploadObjectTask is an abstract interface to record the information for resumable uploading object payload data to the primary SP."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type ResumableUploadObjectTask interface {\n    ObjectTask\n    // InitResumableUploadObjectTask inits the UploadObjectTask by ObjectInfo and Params.\n    InitResumableUploadObjectTask(vgfID uint32, object *storagetypes.ObjectInfo, params *storagetypes.Params, timeout int64, complete bool, offset uint64)\n    // GetVirtualGroupFamilyId returns the object's virtual group family which is bind in bucket.\n    GetVirtualGroupFamilyId() uint32\n    // GetResumeOffset return resumable offset user-supplied parameters\n    GetResumeOffset() uint64\n    // SetResumeOffset Set the `ResumeOffset` provided by the user for subsequent processing in the `HandleResumableUploadObjectTask`.\n    SetResumeOffset(offset uint64)\n    // GetCompleted The GetCompleted() function returns the value of completed set by the user in the request.\n    // The completed parameter represents the last upload request in the resumable upload process,\n    // after which integrity checks and replication procedures will be performed.\n    GetCompleted() bool\n    // SetCompleted sets the state from request in InitResumableUploadObjectTask\n    SetCompleted(completed bool)\n}\n")),(0,r.kt)("h4",{id:"replicatepiecetask"},"ReplicatePieceTask"),(0,r.kt)("p",null,"The ReplicatePieceTask is an abstract interface to record the information for replicating pieces of object payload data to secondary SPs."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type ReplicatePieceTask interface {\n    ObjectTask\n    // InitReplicatePieceTask inits the ReplicatePieceTask by ObjectInfo, params,\n    // task priority, timeout and max retry.\n    InitReplicatePieceTask(object *storagetypes.ObjectInfo, params *storagetypes.Params, priority TPriority, timeout int64, retry int64)\n    // GetSealed returns an indicator whether successful seal object on greenfield\n    // after replicate pieces, it is an optimization method. ReplicatePieceTask and\n    // SealObjectTask are combined. Otherwise, the two tasks will be completed in\n    // two stages. If the combination is successful and the seal object is successful,\n    // the number of SealObjectTask can be reduced, saving resource overhead.\n    GetSealed() bool\n    // SetSealed sets the state successful seal object after replicating piece.\n    SetSealed(bool)\n    // GetSecondaryAddresses returns the secondary SP's addresses. It is used to\n    // generate MsgSealObject.\n    GetSecondaryAddresses() []string\n    // SetSecondaryAddresses sets the secondary SP's addresses.\n    SetSecondaryAddresses([]string)\n    // GetSecondarySignatures returns the secondary SP's signatures. It is used to\n    // generate MsgSealObject.\n    GetSecondarySignatures() [][]byte\n    // SetSecondarySignatures sets the secondary SP's signatures.\n    SetSecondarySignatures([][]byte)\n    // GetGlobalVirtualGroupId returns the object's global virtual group id.\n    GetGlobalVirtualGroupId() uint32\n    // GetSecondaryEndpoints return the secondary sp domain.\n    GetSecondaryEndpoints() []string\n}\n")),(0,r.kt)("h4",{id:"receivepiecetask"},"ReceivePieceTask"),(0,r.kt)("p",null,"The ReceivePieceTask is an abstract interface to record the information for receiving pieces of object payload data from primary\nSP, it exists only in secondary SP."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type ReceivePieceTask interface {\n    ObjectTask\n    // InitReceivePieceTask init the ReceivePieceTask.\n    InitReceivePieceTask(vgfID uint32, object *storagetypes.ObjectInfo, params *storagetypes.Params, priority TPriority,\n    segmentIdx uint32, redundancyIdx int32, pieceSize int64)\n    // GetSegmentIdx returns the piece index. The piece index identifies the serial number\n    // of segment of object payload data for object piece copy.\n    GetSegmentIdx() uint32\n    // SetSegmentIdx sets the segment index.\n    SetSegmentIdx(uint32)\n    // GetRedundancyIdx returns the redundancy index. The redundancy index identifies the\n    // serial number of the secondary SP for object piece copy.\n    GetRedundancyIdx() int32\n    // SetRedundancyIdx sets the redundancy index.\n    SetRedundancyIdx(int32)\n    // GetPieceSize returns the received piece data size, it is used to resource estimate.\n    GetPieceSize() int64\n    // SetPieceSize sets the received piece data size.\n    SetPieceSize(int64)\n    // GetPieceChecksum returns the checksum of received piece data, it is used to check\n    // the piece data is correct.\n    GetPieceChecksum() []byte\n    // SetPieceChecksum set the checksum of received piece data.\n    SetPieceChecksum([]byte)\n    // GetSignature returns the primary signature of SP, because the InitReceivePieceTask\n    // will be transfer to secondary SP, It is necessary to prove that the task was\n    // sent by a legitimate SP.\n    GetSignature() []byte\n    // SetSignature sets the primary signature of SP.\n    SetSignature([]byte)\n    // GetSignBytes returns the bytes from the task for primary SP to sign.\n    GetSignBytes() []byte\n    // GetSealed returns an indicator whether the object of receiving piece data is\n    // sealed on greenfield, the secondary SP has an incentive to confirm that otherwise\n    // it wastes its storage resources\n    GetSealed() bool\n    // SetSealed sets the object of receiving piece data whether is successfully sealed.\n    SetSealed(bool)\n    // GetFinished returns whether replicate piece is done\n    GetFinished() bool\n    // SetFinished sets finished field\n    SetFinished(bool)\n    // GetGlobalVirtualGroupId returns the object's global virtual group id.\n    GetGlobalVirtualGroupId() uint32\n    // SetGlobalVirtualGroupID sets the object's global virtual group id.\n    SetGlobalVirtualGroupID(uint32)\n    // GetBucketMigration returns whether receiver does bucket migration\n    GetBucketMigration() bool\n    // SetBucketMigration sets the bucket migration\n    SetBucketMigration(bool)\n}\n")),(0,r.kt)("h4",{id:"sealobjecttask"},"SealObjectTask"),(0,r.kt)("p",null,"The SealObjectTask is an abstract interface to  record the information for sealing object to the Greenfield chain."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type SealObjectTask interface {\n    ObjectTask\n    // InitSealObjectTask inits the SealObjectTask.\n    InitSealObjectTask(vgfID uint32, object *storagetypes.ObjectInfo, params *storagetypes.Params, priority TPriority, addresses []string,\n    signatures [][]byte, timeout int64, retry int64)\n    // GetSecondaryAddresses return the secondary SP's addresses.\n    GetSecondaryAddresses() []string\n    // GetSecondarySignatures return the secondary SP's signature, it is used to generate\n    // MsgSealObject.\n    GetSecondarySignatures() [][]byte\n    // GetGlobalVirtualGroupId returns the object's global virtual group id.\n    GetGlobalVirtualGroupId() uint32\n}\n")),(0,r.kt)("h4",{id:"downloadobjecttask"},"DownloadObjectTask"),(0,r.kt)("p",null,"The DownloadObjectTask is an abstract interface to record the information for downloading pieces of object payload data."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type DownloadObjectTask interface {\n    ObjectTask\n    // InitDownloadObjectTask inits DownloadObjectTask.\n    InitDownloadObjectTask(object *storagetypes.ObjectInfo, bucket *storagetypes.BucketInfo, params *storagetypes.Params,\n    priority TPriority, userAddress string, low int64, high int64, timeout int64, retry int64)\n    // GetBucketInfo returns the BucketInfo of the download object.\n    // It is used to Query and calculate bucket read quota.\n    GetBucketInfo() *storagetypes.BucketInfo\n    // SetBucketInfo sets the BucketInfo of the download object.\n    SetBucketInfo(*storagetypes.BucketInfo)\n    // GetSize returns the download payload data size, high - low + 1.\n    GetSize() int64\n    // GetLow returns the start offset of download payload data.\n    GetLow() int64\n    // GetHigh returns the end offset of download payload data.\n    GetHigh() int64\n}\n")),(0,r.kt)("h4",{id:"downloadpiecetask"},"DownloadPieceTask"),(0,r.kt)("p",null,"DownloadPieceTask is an abstract interface to record the information for downloading piece data."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type DownloadPieceTask interface {\n    ObjectTask\n    // InitDownloadPieceTask inits DownloadPieceTask.\n    InitDownloadPieceTask(object *storagetypes.ObjectInfo, bucket *storagetypes.BucketInfo, params *storagetypes.Params,\n        priority TPriority, enableCheck bool, userAddress string, totalSize uint64, pieceKey string, pieceOffset uint64,\n        pieceLength uint64, timeout int64, maxRetry int64)\n    // GetBucketInfo returns the BucketInfo of the download object.\n    // It is used to Query and calculate bucket read quota.\n    GetBucketInfo() *storagetypes.BucketInfo\n    // SetBucketInfo sets the BucketInfo of the download object.\n    SetBucketInfo(*storagetypes.BucketInfo)\n    // GetUserAddress returns the user account of downloading object.\n    // It is used to record the read bucket information.\n    GetUserAddress() string\n    // SetUserAddress sets the user account of downloading object.\n    SetUserAddress(string)\n    // GetSize returns the download payload data size.\n    GetSize() int64\n    // GetEnableCheck returns enable_check flag.\n    GetEnableCheck() bool\n    // GetTotalSize returns total size.\n    GetTotalSize() uint64\n    // GetPieceKey returns piece key.\n    GetPieceKey() string\n    // GetPieceOffset returns piece offset.\n    GetPieceOffset() uint64\n    // GetPieceLength returns piece length.\n    GetPieceLength() uint64\n}\n")),(0,r.kt)("h4",{id:"challengepiecetask"},"ChallengePieceTask"),(0,r.kt)("p",null,"ChallengePieceTask is an abstract interface to record the information for get challenge piece info, the validator get challenge\ninfo to confirm whether the sp stores the user's data correctly."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type ChallengePieceTask interface {\n    ObjectTask\n    // InitChallengePieceTask inits InitChallengePieceTask.\n    InitChallengePieceTask(object *storagetypes.ObjectInfo, bucket *storagetypes.BucketInfo, params *storagetypes.Params,\n        priority TPriority, userAddress string, replicateIdx int32, segmentIdx uint32, timeout int64, retry int64)\n    // GetBucketInfo returns the BucketInfo of challenging piece\n    GetBucketInfo() *storagetypes.BucketInfo\n    // SetBucketInfo sets the BucketInfo of challenging piece\n    SetBucketInfo(*storagetypes.BucketInfo)\n    // GetUserAddress returns the user account of challenging object.\n    // It is used to record the read bucket information.\n    GetUserAddress() string\n    // SetUserAddress sets the user account of challenging object.\n    SetUserAddress(string)\n    // GetSegmentIdx returns the segment index of challenge piece.\n    GetSegmentIdx() uint32\n    // SetSegmentIdx sets the segment index of challenge piece.\n    SetSegmentIdx(uint32)\n    // GetRedundancyIdx returns the replicate index of challenge piece.\n    GetRedundancyIdx() int32\n    // SetRedundancyIdx sets the replicate index of challenge piece.\n    SetRedundancyIdx(idx int32)\n    // GetIntegrityHash returns the integrity hash of the object.\n    GetIntegrityHash() []byte\n    // SetIntegrityHash sets the integrity hash of the object.\n    SetIntegrityHash([]byte)\n    // GetPieceHash returns the hash of  challenge piece.\n    GetPieceHash() [][]byte\n    // SetPieceHash sets the hash of  challenge piece.\n    SetPieceHash([][]byte)\n    // GetPieceDataSize returns the data of challenge piece.\n    GetPieceDataSize() int64\n    // SetPieceDataSize sets the data of challenge piece.\n    SetPieceDataSize(int64)\n}\n")),(0,r.kt)("h3",{id:"gc-task"},"GC Task"),(0,r.kt)("p",null,"GCTask is an abstract interface to record the information of garbage collection."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type GCTask interface {\n    Task\n}\n")),(0,r.kt)("h4",{id:"gcobjecttask"},"GCObjectTask"),(0,r.kt)("p",null,"The GCObjectTask is an abstract interface to record the information for collecting the piece store space by deleting object payload\ndata that the object has been deleted on Greenfield chain."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type GCObjectTask interface {\n    GCTask\n    // InitGCObjectTask inits InitGCObjectTask.\n    InitGCObjectTask(priority TPriority, start, end uint64, timeout int64)\n    // SetStartBlockNumber sets start block number for collecting object.\n    SetStartBlockNumber(uint64)\n    // GetStartBlockNumber returns start block number for collecting object.\n    GetStartBlockNumber() uint64\n    // SetEndBlockNumber sets end block number for collecting object.\n    SetEndBlockNumber(uint64)\n    // GetEndBlockNumber returns end block number for collecting object.\n    GetEndBlockNumber() uint64\n    // SetCurrentBlockNumber sets the collecting block number.\n    SetCurrentBlockNumber(uint64)\n    // GetCurrentBlockNumber returns the collecting block number.\n    GetCurrentBlockNumber() uint64\n    // GetLastDeletedObjectId returns the last deleted ObjectID.\n    GetLastDeletedObjectId() uint64\n    // SetLastDeletedObjectId sets the last deleted ObjectID.\n    SetLastDeletedObjectId(uint64)\n    // GetGCObjectProgress returns the progress of collecting object, returns the\n    // deleting block number and the last deleted object id.\n    GetGCObjectProgress() (uint64, uint64)\n    // SetGCObjectProgress sets the progress of collecting object, params stand\n    // the deleting block number and the last deleted object id.\n    SetGCObjectProgress(uint64, uint64)\n}\n")),(0,r.kt)("h4",{id:"gczombiepiecetask"},"GCZombiePieceTask"),(0,r.kt)("p",null,"The GCZombiePieceTask is an abstract interface to record the information for collecting the piece store space by deleting zombie\npieces data that dues to any exception, the piece data meta is not on chain but the pieces has been store in piece store."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type GCZombiePieceTask interface {\n    GCTask\n    // GetGCZombiePieceStatus returns the status of collecting zombie pieces, returns\n    // the last deleted object id and the number that has been deleted.\n    GetGCZombiePieceStatus() (uint64, uint64)\n    // SetGCZombiePieceStatus sets the status of collecting zombie pieces, param\n    // stands the last deleted object id and the has been deleted pieces number.\n    SetGCZombiePieceStatus(uint64, uint64)\n}\n")),(0,r.kt)("h4",{id:"gcmetatask"},"GCMetaTask"),(0,r.kt)("p",null,"The GCMetaTask is an abstract interface to record the information for collecting the SP meta store space by deleting the expired data."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type GCMetaTask interface {\n    GCTask\n    // GetGCMetaStatus returns the status of collecting metadata, returns the last\n    // deleted object id and the number that has been deleted.\n    GetGCMetaStatus() (uint64, uint64)\n    // SetGCMetaStatus sets the status of collecting metadata, parma stands the last\n    // deleted object id and the number that has been deleted.\n    SetGCMetaStatus(uint64, uint64)\n}\n")),(0,r.kt)("h3",{id:"recoverypiecetask"},"RecoveryPieceTask"),(0,r.kt)("p",null,"The RecoveryPieceTask is the interface to record the information for recovering"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type RecoveryPieceTask interface {\n    ObjectTask\n    // InitRecoverPieceTask inits the RecoveryPieceTask by ObjectInfo, params,\n    // task priority, pieceIndex, timeout and max retry.\n    InitRecoverPieceTask(object *storagetypes.ObjectInfo, params *storagetypes.Params,\n        priority TPriority, pieceIdx uint32, ecIdx int32, pieceSize uint64, timeout int64, retry int64)\n\n    // GetSegmentIdx return the segment index of recovery object segment\n    GetSegmentIdx() uint32\n    // GetEcIdx return the ec index of recovery ec chunk\n    GetEcIdx() int32\n    // GetSignature returns the primary SP's signature\n    GetSignature() []byte\n    // SetSignature sets the primary SP's signature.\n    SetSignature([]byte)\n    // GetSignBytes returns the bytes from the task for primary SP to sign.\n    GetSignBytes() []byte\n    GetRecovered() bool\n    // SetRecoverDone set the recovery status as finish\n    SetRecoverDone()\n}\n")),(0,r.kt)("h3",{id:"migrategvgtask"},"MigrateGVGTask"),(0,r.kt)("p",null,"MigrateGVGTask is an abstract interface to record migrate gvg information."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type MigrateGVGTask interface {\n    Task\n    // InitMigrateGVGTask inits migrate gvg task by bucket id, gvg.\n    InitMigrateGVGTask(priority TPriority, bucketID uint64, srcGvg *virtualgrouptypes.GlobalVirtualGroup,\n        redundancyIndex int32, srcSP *sptypes.StorageProvider, timeout int64, retry int64)\n    // GetSrcGvg returns the src global virtual group\n    GetSrcGvg() *virtualgrouptypes.GlobalVirtualGroup\n    // SetSrcGvg sets the src global virtual group\n    SetSrcGvg(*virtualgrouptypes.GlobalVirtualGroup)\n    // GetDestGvg returns the dest global virtual group\n    GetDestGvg() *virtualgrouptypes.GlobalVirtualGroup\n    // SetDestGvg sets the dest global virtual group\n    SetDestGvg(*virtualgrouptypes.GlobalVirtualGroup)\n    // GetSrcSp returns the src storage provider\n    GetSrcSp() *sptypes.StorageProvider\n    // SetSrcSp sets the src storage provider\n    SetSrcSp(*sptypes.StorageProvider)\n    // GetBucketID returns the bucketID\n    GetBucketID() uint64\n    // SetBucketID sets the bucketID\n    SetBucketID(uint64)\n    // GetRedundancyIdx returns the redundancy index\n    GetRedundancyIdx() int32\n    // SetRedundancyIdx sets the redundancy index\n    SetRedundancyIdx(int32)\n    // GetLastMigratedObjectID returns the last modified objectID\n    GetLastMigratedObjectID() uint64\n    // SetLastMigratedObjectID sets the last migrated objectID\n    SetLastMigratedObjectID(uint64)\n    // GetFinished returns the task whether finished\n    GetFinished() bool\n    // SetFinished sets the migrated gvg task status when finished\n    SetFinished(bool)\n}\n")),(0,r.kt)("h2",{id:"task-type-definition"},"Task Type Definition"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"// TType is enum type, it defines the type of task.\ntype TType int32\n\nconst (\n    // TypeTaskUnknown defines the default task type.\n    TypeTaskUnknown TType = iota\n    // TypeTaskCreateBucketApproval defines the type of asking create bucket approval\n    // to primary SP task\n    TypeTaskCreateBucketApproval\n    // TypeTaskCreateObjectApproval defines the type of asking create object approval\n    // to primary SP task\n    TypeTaskCreateObjectApproval\n    // TypeTaskReplicatePieceApproval defines the type of asking create object approval\n    // to secondary SP task\n    TypeTaskReplicatePieceApproval\n    // TypeTaskUpload defines the type of uploading object to primary SP task.\n    TypeTaskUpload\n    // TypeTaskReplicatePiece defines the type of replicating pieces to secondary SPs task.\n    TypeTaskReplicatePiece\n    // TypeTaskSealObject defines the type of sealing object to the chain task.\n    TypeTaskSealObject\n    // TypeTaskReceivePiece defines the type of receiving pieces for secondary SP task.\n    TypeTaskReceivePiece\n    // TypeTaskDownloadObject defines the type of downloading object task.\n    TypeTaskDownloadObject\n    // TypeTaskDownloadPiece defines the type of downloading piece task.\n    TypeTaskDownloadPiece\n    // TypeTaskChallengePiece defines the type of challenging piece task.\n    TypeTaskChallengePiece\n    // TypeTaskGCObject defines the type of collecting object payload data task.\n    TypeTaskGCObject\n    // TypeTaskGCZombiePiece defines the type of collecting zombie piece task.\n    TypeTaskGCZombiePiece\n    // TypeTaskGCMeta defines the type of collecting SP metadata task.\n    TypeTaskGCMeta\n)\n")),(0,r.kt)("h2",{id:"task-priority"},"Task Priority"),(0,r.kt)("p",null,"Each type of task has a priority, the range of priority is ","[0, 255]",", the higher the priority, the higher the urgency to\nbe executed, the greater the probability of being executed by priority scheduling."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type TPriority uint8\n\nconst (\n    // UnKnownTaskPriority defines the default task priority.\n    UnKnownTaskPriority TPriority = 0\n    // UnSchedulingPriority defines the task priority that should be never scheduled.\n    UnSchedulingPriority TPriority = 0\n    // MaxTaskPriority defines the max task priority.\n    MaxTaskPriority TPriority = 255\n    // DefaultLargerTaskPriority defines the larger task priority.\n    DefaultLargerTaskPriority TPriority = 170\n    // DefaultSmallerPriority defines the smaller task priority.\n    DefaultSmallerPriority TPriority = 85\n)\n")),(0,r.kt)("h2",{id:"task-priority-level"},"Task Priority Level"),(0,r.kt)("p",null,"Task priority is divided into three levels, TLowPriorityLevel, TMediumPriorityLevel, THighPriorityLevel. The TLowPriorityLevel\ndefault priority range is [0, 85), The TMediumPriorityLevel default priority range is [85, 170), The THighPriorityLevel\ndefault priority range is [170, 256). When allocating for task execution resources from ResourceManager, the resources\nare allocated according to task priority level, but not task priority, because task priority up to 256 levels, the task priority\nlevel make resource management easier."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Example:\n    the resource limit configuration of task execution node :\n        [TasksHighPriority: 30, TasksMediumPriority: 20, TasksLowPriority: 2]\n    the executor of the task can run 30 high level tasks at the same time that the\n        task priority between [170, 255]\n    the executor of the task can run 20 medium level tasks at the same time that the\n        task priority between [85, 170)\n    the executor of the task can run 2 medium level tasks at the same time that the\n        task priority < 85\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type TPriorityLevel int32\n\nconst (\n    // TLowPriorityLevel defines the low task priority level.\n    TLowPriorityLevel TPriorityLevel = iota\n    // TMediumPriorityLevel defines the medium task priority level.\n    TMediumPriorityLevel\n    // THighPriorityLevel defines the high task priority level.\n    THighPriorityLevel\n)\n")),(0,r.kt)("h2",{id:"task-init"},"Task Init"),(0,r.kt)("p",null,"Each task needs to call its InitXXXTask method before use. This method requires passing in the necessary parameters of\neach type of task. These parameters will not be changed in most cases and are necessary, such as task priority, timeout,\nmax retries, and necessary information for resource estimation."),(0,r.kt)("p",null,"Any changes to initialization parameters during task execution may cause unpredictable consequences. For example, changes\nin parameters that affect resource estimation may cause OOM, etc."))}u.isMDXComponent=!0}}]);