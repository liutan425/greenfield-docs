<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guide/greenfield-blockchain/modules/virtual-group">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Virtual Group | BNB Greenfield</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://bnb-chain.github.io/greenfield-docs/docs/guide/greenfield-blockchain/modules/virtual-group"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Virtual Group | BNB Greenfield"><meta data-rh="true" name="description" content="Abstract"><meta data-rh="true" property="og:description" content="Abstract"><link data-rh="true" rel="icon" href="/greenfield-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://bnb-chain.github.io/greenfield-docs/docs/guide/greenfield-blockchain/modules/virtual-group"><link data-rh="true" rel="alternate" href="https://bnb-chain.github.io/greenfield-docs/docs/guide/greenfield-blockchain/modules/virtual-group" hreflang="en"><link data-rh="true" rel="alternate" href="https://bnb-chain.github.io/greenfield-docs/docs/guide/greenfield-blockchain/modules/virtual-group" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://3LF005YNGZ-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/greenfield-docs/blog/rss.xml" title="BNB Greenfield RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/greenfield-docs/blog/atom.xml" title="BNB Greenfield Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="BNB Greenfield" href="/greenfield-docs/opensearch.xml"><link rel="stylesheet" href="/greenfield-docs/assets/css/styles.52c35f0a.css">
<link rel="preload" href="/greenfield-docs/assets/js/runtime~main.b2bcb091.js" as="script">
<link rel="preload" href="/greenfield-docs/assets/js/main.b0c04e25.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/greenfield-docs/"><div class="navbar__logo"><img src="/greenfield-docs/img/logo.svg" alt="Greenfield Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/greenfield-docs/img/logo.svg" alt="Greenfield Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">BNB Greenfield</b></a><a class="navbar__item navbar__link" href="/greenfield-docs/docs/guide/introduction/overview">Guide</a><a class="navbar__item navbar__link" href="/greenfield-docs/docs/tutorials/overview">Tutorials</a><a class="navbar__item navbar__link" href="/greenfield-docs/docs/api/endpoints">API &amp; SDK</a><a class="navbar__item navbar__link" href="/greenfield-docs/docs/release-notes/releaseNotes">Releases</a><a class="navbar__item navbar__link" href="/greenfield-docs/docs/faq/greenfield-faqs">FAQs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/bnb-chain/greenfield-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/greenfield-docs/docs/guide/home">Introduction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Introduction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/greenfield-docs/docs/guide/getting-started/overview">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/greenfield-docs/docs/guide/core-concept/accounts">Core Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/greenfield-docs/docs/guide/greenfield-blockchain/overview">Greenfield Blockchain</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/greenfield-docs/docs/guide/greenfield-blockchain/overview">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/greenfield-docs/docs/guide/greenfield-blockchain/modules/storage-module">Modules</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/greenfield-docs/docs/guide/greenfield-blockchain/modules/storage-module">Storage Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/greenfield-docs/docs/guide/greenfield-blockchain/modules/storage-provider">Storage Provider</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/greenfield-docs/docs/guide/greenfield-blockchain/modules/billing-and-payment">Billing and Payment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/greenfield-docs/docs/guide/greenfield-blockchain/modules/permission">Permission</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/greenfield-docs/docs/guide/greenfield-blockchain/modules/cross-chain">Cross Chain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/greenfield-docs/docs/guide/greenfield-blockchain/modules/consensus-and-staking">Consensus and Staking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/greenfield-docs/docs/guide/greenfield-blockchain/modules/governance">Governance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/greenfield-docs/docs/guide/greenfield-blockchain/modules/data-availability-challenge">Data Availability Challenge</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/greenfield-docs/docs/guide/greenfield-blockchain/modules/virtual-group">Virtual Group</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/greenfield-docs/docs/guide/greenfield-blockchain/modules/world-state">World State</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/greenfield-docs/docs/guide/greenfield-blockchain/run-node/interact-node">Run Node</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/greenfield-docs/docs/guide/storage-provider/introduction/overview">Storage Provider</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/greenfield-docs/docs/contribute">Contribute</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/bnb-chain/greenfield-whitepaper" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Whitepaper<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_BDYx"><div class="docItemContainer_oq1c"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/greenfield-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Greenfield Blockchain</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Modules</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Virtual Group</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="row"><div class="col col--12"><h1>Virtual Group</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="abstract">Abstract<a class="hash-link" href="#abstract" title="Direct link to heading">​</a></h2><p>We propose the adoption of Virtual Groups as a solution to untangle the interdependency between Buckets/Objects and Storage Providers (SPs). This approach effectively reduces the need for a large number of transactions to be transmitted when modifying the on-chain BucketInfo and ObjectInfo during SP exits and bucket migrations.</p><p>A Virtual Group comprises a primary storage provider and several secondary storage providers. Each object is associated with a specific virtual group, which restricts the range of secondary storage providers responsible for storing object replica data. The number of storage providers in each virtual group is determined by the redundancy policy. For example, if our redundancy policy specifies a full replica and a 4+2 erasure coding (EC) replica, every virtual group should consist of one primary SP and six secondary SPs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="terminology">Terminology<a class="hash-link" href="#terminology" title="Direct link to heading">​</a></h3><ul><li>Global Virtual Group (GVG): A global virtual group consists of one primary SP (SP) and multiple secondary SPs.
Local Virtual Group(LVG): Each bucket maintains a mapping from the local group ID to the global group ID. j(e.g 3 ➝ 001960583).</li><li>Virtual Group Family(VGF): Each primary storage provider can create multiple virtual group families, with each family containing several global virtual groups. Each family serves a limited number of buckets. Once the store size exceeds a specified threshold, the family will no longer allow to serve more buckets.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="relationships">Relationships<a class="hash-link" href="#relationships" title="Direct link to heading">​</a></h3><p>Local virtual groups are linked to their corresponding buckets, and each object needs to store the ID information of the local virtual group. Each local virtual group must correspond to one and only one global virtual group.</p><p><img loading="lazy" alt="VirtualGroup Overview" src="/greenfield-docs/assets/images/12-Greenfield-VirtualGroup-c13cd82770cd4a47ffe2220ec7121683.png" width="1884" height="1140" class="img_ev3q"></p><p>In order to avoid all the data of a primary SP being transferred to one SP within a short period of time, we introduce the concept of &quot;family&quot;. </p><p><img loading="lazy" alt="VirtualGroup Family" src="/greenfield-docs/assets/images/13-Greenfield-VirtualGroupFamily-d195312db08ea552c5874f2edd25ec90.png" width="1464" height="872" class="img_ev3q"></p><p>A family can contain multiple GVG that the same SP creates. A bucket can only be served by the GVGs that are in the same family, cross family GVG is not allowed within one bucket. Once the total storage size of a family exceeds 64TB(TBD), the GVG inside the family can not server new buckets, the SP has to create a new family. By introducing family , the primary SP can exit at family level without breaking the one bucket, one primary SP rule.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="staking-for-storage">Staking For Storage<a class="hash-link" href="#staking-for-storage" title="Direct link to heading">​</a></h3><p>We introduce a new staking rule based on storage size. The minimum required staking tokens can be calculated using the formula storage_staking_price * stored_size . The storage providers have the option to pre-stake tokens for upcoming storage if needed.</p><p>All staking tokens will be managed by the Virtual Group Module account. Only during deletion or swapping out, the storage providers can get these staking tokens back. In the event of a storage provider&#x27;s forced exit, these tokens will be forfeited and used to reward those storage providers which take over these GVG.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-workflow">Key Workflow<a class="hash-link" href="#key-workflow" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creation-and-destruction">Creation and Destruction<a class="hash-link" href="#creation-and-destruction" title="Direct link to heading">​</a></h3><p>A Global Virtual Group (GVG) can be created autonomously by any storage provider without the need for approvals from secondary SPs. Nevertheless, in order to control the proliferation of validator groups, the creation of a GVP entails relatively higher fees and need staking for storage.</p><p>The count of secondary SPs within a group can serve as an indicator of redundancy for all objects stored within that group. With the capability to establish distinct secondary virtual groups with varying levels of redundancy, the system offers significant flexibility.</p><p>When creating a GVG (Global Virtual Group), if no GVG Family is specified, the transaction will automatically create a family on-chain and associate it with the newly created GVG.</p><p>Conversely, a Local Virtual Group (LVG) is automatically generated during object creation, but its quantity within a bucket should be restricted to a specific limit.</p><p>When the stored size within a GVG becomes zero, any SP (Storage Provider) within it can delete it and the staking tokens will be return to the owner of this GVG. We cannot proactively delete a GVG family. If all GVGs within the family are deleted, the family will be automatically removed as well.</p><p>We also do not need to manually delete LVGs, as they are always removed automatically when the associated bucket is deleted.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sp-exit-workflow">SP Exit Workflow<a class="hash-link" href="#sp-exit-workflow" title="Direct link to heading">​</a></h3><p>Below are the key steps in the Storage Provider (SP) exit process:</p><ol><li>The Storage Provider (SP1) initiates the exit process by submitting a StorageProviderExit transaction to the blockchain.</li><li>Subsequently, SP1 or its successor SP must repeatedly call SwapOut to remove itself from all Global Virtual Groups (GVGs).</li><li>For the primary SP, the swap-out process occurs at the family level, ensuring there are no conflicts with other SPs within the GVG.</li><li>For secondary SPs, the swap-out happens at the GVG level and must also avoid conflicts with the primary SP.</li><li>Once SP1 successfully completes the swap-out process from all GVGs, it can submit a CompleteStorageProviderExit transaction to retrieve the staked tokens.</li></ol><p>This orderly exit process ensures a smooth transition of responsibilities and resources while preserving the integrity of the network and the staked tokens associated with the exiting SP.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bucket-migration-workflow">Bucket Migration Workflow<a class="hash-link" href="#bucket-migration-workflow" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="Bucket Miragtion" src="/greenfield-docs/assets/images/14-Greenfield-Bucket-Migration-bb0d1def2411f12eae31bc91cfc57463.png" width="1782" height="1262" class="img_ev3q"></p><p>Below are the key workflow of Bucket Migration:</p><ol><li>The user submits a bucket migration transaction with the signature of the new primary SP.</li><li>The new SP starts receiving full data from the old primary SP or from secondary SPs.</li><li>The new SP distributes data among the secondary SPs according to his new GVPs. (more details required...)</li><li>The new SP submit a bucket seal transaction on-chain along with all the aggregate signature from new secondary SPs.</li><li>The on-chain module will:<ul><li>Unbind the old LVG and GVG mapping, and build a new mapping relationship.</li><li>Settle the payment stream between LVG, GVF, and SPs.</li></ul></li><li>During the migration period, the user can not upload files to this bucket.</li><li>During the migration period, the old SP should still serve the query request.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="params">Params<a class="hash-link" href="#params" title="Direct link to heading">​</a></h2><p>The virtial group module contains the following parameters,
they can be updated with governance.</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Params defines the parameters for the module.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message Params {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  option (gogoproto.equal) = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  option (gogoproto.goproto_stringer) = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // deposit_denom defines the staking coin denomination.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string deposit_denom = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // store price, in bnb wei per charge byte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string gvg_staking_per_bytes = 2 [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (cosmos_proto.scalar) = &quot;cosmos.Int&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (gogoproto.customtype) = &quot;github.com/cosmos/cosmos-sdk/types.Int&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (gogoproto.nullable) = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // the max number of lvg which allowed in a bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 max_local_virtual_group_num_per_bucket = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // the max number of gvg which can exist in a family</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 max_global_virtual_group_num_per_family = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // if the store size reach the exceed, the family is not allowed to sever more buckets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint64 max_store_size_per_family = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="states">States<a class="hash-link" href="#states" title="Direct link to heading">​</a></h2><p>The virtualgroup module keeps state of the following primary objects.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="global-virtual-group">Global Virtual Group<a class="hash-link" href="#global-virtual-group" title="Direct link to heading">​</a></h3><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// A global virtual group consists of one primary SP (SP) and multiple secondary SP.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Every global virtual group must belong to a GVG family, and the objects of each</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// bucket must be stored in a GVG within a group family.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message GlobalVirtualGroup {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ID represents the unique identifier of the global virtual group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Family ID represents the identifier of the GVG family that the group belongs to.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 family_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Primary SP ID represents the unique identifier of the primary storage provider in the group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 primary_sp_id = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Secondary SP IDs represents the list of unique identifiers of the secondary storage providers in the group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated uint32 secondary_sp_ids = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Stored size represents the size of the stored objects within the group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint64 stored_size = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Virtual payment address represents the payment address associated with the group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string virtual_payment_address = 6 [(cosmos_proto.scalar) = &quot;cosmos.AddressString&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Total deposit represents the number of tokens deposited by this storage provider for staking.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string total_deposit = 7 [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (cosmos_proto.scalar) = &quot;cosmos.Int&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (gogoproto.customtype) = &quot;github.com/cosmos/cosmos-sdk/types.Int&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (gogoproto.nullable) = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="global-virtual-group-family">Global Virtual Group Family<a class="hash-link" href="#global-virtual-group-family" title="Direct link to heading">​</a></h3><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Global virtual group family serve as a means of grouping global virtual groups.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Each bucket must be associated with a unique global virtual group family and cannot cross families.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message GlobalVirtualGroupFamily {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // id is the identifier of the global virtual group family.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // primary_sp_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 primary_sp_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // global_virtual_group_ids is a list of identifiers of the global virtual groups associated with the family.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated uint32 global_virtual_group_ids = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // virtual_payment_address is the payment address associated with the global virtual group family.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string virtual_payment_address = 4 [(cosmos_proto.scalar) = &quot;cosmos.AddressString&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="swap-out-info">Swap Out Info<a class="hash-link" href="#swap-out-info" title="Direct link to heading">​</a></h3><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message SwapOutInfo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // sp_id is the unique id of the storage provider who want to swap out.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 sp_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // successor_sp_id is the id of the successor storage provider.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 successor_sp_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="messages">Messages<a class="hash-link" href="#messages" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="msgcreateglobalvirtualgroup">MsgCreateGlobalVirtualGroup<a class="hash-link" href="#msgcreateglobalvirtualgroup" title="Direct link to heading">​</a></h3><p>Used to create a new global virtual group.</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message MsgCreateGlobalVirtualGroup {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  option (cosmos.msg.v1.signer) = &quot;storage_provider&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // storage_provider defines the operator account address of the storage provider who create the global virtual group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string storage_provider = 1 [(cosmos_proto.scalar) = &quot;cosmos.AddressString&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // family_id is the identifier for the virtual group&#x27;s family.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 family_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // secondary_sp_id is a list of secondary storage provider IDs associated with the virtual group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated uint32 secondary_sp_ids = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // total_deposit is the total deposit amount required for the virtual group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The tokens needs deposited and the size of storage are correlated.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cosmos.base.v1beta1.Coin deposit = 4 [(gogoproto.nullable) = false];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="msgdeleteglobalvirtualgroup">MsgDeleteGlobalVirtualGroup<a class="hash-link" href="#msgdeleteglobalvirtualgroup" title="Direct link to heading">​</a></h3><p>Used to delete a global virtual group.</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message MsgDeleteGlobalVirtualGroup {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  option (cosmos.msg.v1.signer) = &quot;storage_provider&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // storage_provider defines the operator account address of the storage provider who delete the global virtual group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string storage_provider = 1 [(cosmos_proto.scalar) = &quot;cosmos.AddressString&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // global_virtual_group_id is the identifier of the global virtual group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 global_virtual_group_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="msgdeposit">MsgDeposit<a class="hash-link" href="#msgdeposit" title="Direct link to heading">​</a></h3><p>Used to deposit more tokens for the objects stored on it.</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message MsgDeposit {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  option (cosmos.msg.v1.signer) = &quot;storage_provider&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // storage_provider defines the operator/funding account address of the storage provider who deposit to the global virtual group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string storage_provider = 1 [(cosmos_proto.scalar) = &quot;cosmos.AddressString&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // global_virtual_group_id is the identifier of the global virtual group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 global_virtual_group_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // deposit is the amount of tokens being deposited for the global virtual group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cosmos.base.v1beta1.Coin deposit = 3 [(gogoproto.nullable) = false];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="msgwithdraw">MsgWithdraw<a class="hash-link" href="#msgwithdraw" title="Direct link to heading">​</a></h3><p>Used to withdraw the excess tokens </p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message MsgWithdraw {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  option (cosmos.msg.v1.signer) = &quot;storage_provider&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // storage_provider defines the operator/funding account address of the storage provider who withdraw from the global virtual group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string storage_provider = 1 [(cosmos_proto.scalar) = &quot;cosmos.AddressString&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // global_virtual_group_id is the identifier of the global virtual group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 global_virtual_group_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // withdraw is the amount of coins to be withdrawn.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The amount needs to be smaller than stored_size * storage_staking_price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cosmos.base.v1beta1.Coin withdraw = 3 [(gogoproto.nullable) = false];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="msgsettle">MsgSettle<a class="hash-link" href="#msgsettle" title="Direct link to heading">​</a></h3><p>Used to settle the virtual payment account of the gvg and gvg family</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// MsgSettle define the message for settling storage income of GVG family or several GVGs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Firstly, the handler will do stream settlement for the payment account; and</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// secondly, the income will be distributed to related storage providers.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message MsgSettle {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  option (cosmos.msg.v1.signer) = &quot;storage_provider&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // storage_provider defines the operator/funding account address of the storage provider who initial settle request.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string storage_provider = 1 [(cosmos_proto.scalar) = &quot;cosmos.AddressString&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // global_virtual_group_family_id is the identifier of the global virtual group family.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 global_virtual_group_family_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // global_virtual_group_id is the identifier of the global virtual group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated uint32 global_virtual_group_ids = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="msgswapout">MsgSwapOut<a class="hash-link" href="#msgswapout" title="Direct link to heading">​</a></h3><p>Used to initiate a swapout transaction and specify successor SP</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message MsgSwapOut {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  option (cosmos.msg.v1.signer) = &quot;storage_provider&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // storage_provider defines the operator account address of the storage provider who want to swap out from the global virtual group.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string storage_provider = 1 [(cosmos_proto.scalar) = &quot;cosmos.AddressString&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // virtual_group_family_id is the identifier of the virtual group family.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // if it set to non-zero, it represents that the operator swap out as the primary storage provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // it it set to zero, it represents that the operator swap out as the secondary storage provider.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 global_virtual_group_family_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // global_virtual_group_ids is a list of global virtual group IDs associated with the swap out.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // It allows to be empty only when the operator is the primary storage provider.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated uint32 global_virtual_group_ids = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // successor_sp_id is the unique id of the successor storage provider.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 successor_sp_id = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // approval includes an expiration time and a signature.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The fields to be signed with contains the necessary information of the successor.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  common.Approval successor_sp_approval = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="completeswapout">CompleteSwapOut<a class="hash-link" href="#completeswapout" title="Direct link to heading">​</a></h3><p>Used to complete the swapout event, which is initiated by successor SP</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message MsgCompleteSwapOut {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  option (cosmos.msg.v1.signer) = &quot;storage_provider&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // storage_provider defines the operator account address of the storage provider who complete swap out task.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string storage_provider = 1 [(cosmos_proto.scalar) = &quot;cosmos.AddressString&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // virtual_group_family_id is the identifier of the virtual group family.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // if it set to non-zero, it represents that the operator swap out as the primary storage provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // it it set to zero, it represents that the operator swap out as the secondary storage provider.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 global_virtual_group_family_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // global_virtual_group_ids is a list of global virtual group IDs associated with the swap out.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // It allows to be empty only when the operator is the primary storage provider.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated uint32 global_virtual_group_ids = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cancelswapout">CancelSwapOut<a class="hash-link" href="#cancelswapout" title="Direct link to heading">​</a></h3><p>Used to cancel the swapout</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message MsgCancelSwapOut {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  option (cosmos.msg.v1.signer) = &quot;storage_provider&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // storage_provider defines the operator account address of the storage provider who cancel the swap out task.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string storage_provider = 1 [(cosmos_proto.scalar) = &quot;cosmos.AddressString&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // virtual_group_family_id is the identifier of the virtual group family.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // if it set to non-zero, it represents that the operator swap out as the primary storage provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // it it set to zero, it represents that the operator swap out as the secondary storage provider.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 global_virtual_group_family_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // global_virtual_group_ids is a list of global virtual group IDs associated with the swap out.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // It allows to be empty only when the operator is the primary storage provider.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated uint32 global_virtual_group_ids = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><div class="col col--12"><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/bnb-chain/greenfield-docs/blob/main/docs/guide/greenfield-blockchain/modules/virtual-group.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></div></article><div class="col col--12"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/greenfield-docs/docs/guide/greenfield-blockchain/modules/data-availability-challenge"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Data Availability Challenge</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/greenfield-docs/docs/guide/greenfield-blockchain/modules/world-state"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">World State</div></a></nav></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#abstract" class="table-of-contents__link toc-highlight">Abstract</a><ul><li><a href="#terminology" class="table-of-contents__link toc-highlight">Terminology</a></li><li><a href="#relationships" class="table-of-contents__link toc-highlight">Relationships</a></li><li><a href="#staking-for-storage" class="table-of-contents__link toc-highlight">Staking For Storage</a></li></ul></li><li><a href="#key-workflow" class="table-of-contents__link toc-highlight">Key Workflow</a><ul><li><a href="#creation-and-destruction" class="table-of-contents__link toc-highlight">Creation and Destruction</a></li><li><a href="#sp-exit-workflow" class="table-of-contents__link toc-highlight">SP Exit Workflow</a></li><li><a href="#bucket-migration-workflow" class="table-of-contents__link toc-highlight">Bucket Migration Workflow</a></li></ul></li><li><a href="#params" class="table-of-contents__link toc-highlight">Params</a></li><li><a href="#states" class="table-of-contents__link toc-highlight">States</a><ul><li><a href="#global-virtual-group" class="table-of-contents__link toc-highlight">Global Virtual Group</a></li><li><a href="#global-virtual-group-family" class="table-of-contents__link toc-highlight">Global Virtual Group Family</a></li><li><a href="#swap-out-info" class="table-of-contents__link toc-highlight">Swap Out Info</a></li></ul></li><li><a href="#messages" class="table-of-contents__link toc-highlight">Messages</a><ul><li><a href="#msgcreateglobalvirtualgroup" class="table-of-contents__link toc-highlight">MsgCreateGlobalVirtualGroup</a></li><li><a href="#msgdeleteglobalvirtualgroup" class="table-of-contents__link toc-highlight">MsgDeleteGlobalVirtualGroup</a></li><li><a href="#msgdeposit" class="table-of-contents__link toc-highlight">MsgDeposit</a></li><li><a href="#msgwithdraw" class="table-of-contents__link toc-highlight">MsgWithdraw</a></li><li><a href="#msgsettle" class="table-of-contents__link toc-highlight">MsgSettle</a></li><li><a href="#msgswapout" class="table-of-contents__link toc-highlight">MsgSwapOut</a></li><li><a href="#completeswapout" class="table-of-contents__link toc-highlight">CompleteSwapOut</a></li><li><a href="#cancelswapout" class="table-of-contents__link toc-highlight">CancelSwapOut</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/greenfield-docs/assets/js/runtime~main.b2bcb091.js"></script>
<script src="/greenfield-docs/assets/js/main.b0c04e25.js"></script>
</body>
</html>